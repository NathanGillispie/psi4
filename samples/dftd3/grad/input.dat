#! DF-BP86-D2 cc-pVDZ frozen core gradient of S22 HCN, calling Grimme's dftd3 program for -D2 gradients
#! update reference for new BraggSlater radii

d3_engine = psi4.driver.EmpiricalDispersion(name_hint="b3lyp", level_hint="d3bj").engine


molecule {
  0 1
  N    -0.0034118    3.5353926    0.0000000
  C     0.0751963    2.3707040    0.0000000
  H     0.1476295    1.3052847    0.0000000
}


set {
    scf_type      df
    basis         cc-pvdz
    freeze_core   true
    dft_radial_points     99
    dft_spherical_points  302
    e_convergence 8
    d_convergence 8
}

if psi4.core.get_option("scf", "orbital_optimizer_package") == "INTERNAL":
    tol = 7
else:
    tol = 3e-7
    psi4.set_options({"e_convergence": 9, "d_convergence": 2e-8})

grad = gradient('bp86-d2', engine='libdisp')
clean()

grad = gradient('bp86-d3m2b')

molecule atoms {
  @He
  Ne 1 1.0
}


E, G = atoms.run_sdftd3('bp86-d3(bj)')

g, wfn = gradient("bp86-d3(bj)", return_wfn=True)
